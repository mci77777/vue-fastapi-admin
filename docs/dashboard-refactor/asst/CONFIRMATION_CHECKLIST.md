# Dashboard 重构需求 - 快速确认清单

**请复制此文件内容，填写您的选择后回复给我。**

---

## 🔴 问题 1：数据统计实现方案（P0 - 核心）

### 1.1 日活监控（JWT 活跃用户数）
- [ ] 方案 A：从 Supabase `user_metrics` 表统计（需新增后端 API）
- [ ] 方案 B：从 Prometheus `auth_requests_total` 指标解析
- [✅ ] 方案 C：新增本地 SQLite 表 `user_activity_stats`
- [ ] 其他：___________

### 1.2 AI 请求数量
- [ ] 方案 A：从 Supabase `chat_sessions` 表统计
- [ ] 方案 B：从 Prometheus `auth_requests_total` 指标解析
- [✅ ] 方案 C：新增本地 SQLite 表 `ai_request_stats`
- [ ] 其他：___________

### 1.3 Token 使用量 + USD 换算
- [ ] 是，立即实现（P0）
- [ ✅] 否，后续追加

**如果选择"是"，请提供**：
- 各模型的 Token 价格表（如 gpt-4o-mini: $0.15/1M input tokens）：
  ```
  模型名称 | Input Token 价格 | Output Token 价格
  ---------|-----------------|------------------
  
  ```
- 费用计算公式：___________

### 1.4 API 连通性
- [ ✅] 方案 A：复用现有 `/api/v1/llm/monitor/status`
- [ ] 方案 B：新增 `/api/v1/stats/api-connectivity`
- [ ] 其他：___________

### 1.5 JWT 可获取性
- [ ] 方案 A：从 Prometheus `auth_requests_total` 计算成功率
- [✅ ] 方案 B：新增 `/api/v1/stats/jwt-availability`
- [ ] 方案 C：定时任务测试 JWT 签发并记录结果
- [ ] 其他：___________

---

## 🟡 问题 2：数据存储策略（P0 - 核心）

### 2.1 本地存储
- [✅ ] 方案 A：SQLite 新增表 `dashboard_stats`
- [ ] 方案 B：JSON 文件 `storage/dashboard_stats.json`
- [ ] 方案 C：内存缓存 + 定时持久化到 SQLite
- [ ] 其他：___________

### 2.2 远端备份
- [ ✅] 方案 A：定时推送到 Supabase 新表 `dashboard_stats`
- [ ] 方案 B：定时推送到 Supabase 现有表（如 `audit_logs` 扩展字段）
- [ ] 方案 C：不做远端备份（仅本地存储）
- [ ] 其他：___________

### 2.3 数据保留策略
- 本地保留：[ ] 7 天 [✅ ] 30 天 [ ] 90 天 [ ] 永久
- 远端保留：[✅ ] 30 天 [ ] 90 天 [ ] 1 年 [ ] 永久

---

## 🟡 问题 3：实时更新机制（P0 - 核心）

### 3.1 前端轮询间隔
- [ ] 5 秒
- [ ] 10 秒（推荐）
- [ ] 30 秒
- [✅] 可配置（用户可调整）

### 3.2 是否需要 WebSocket/SSE 实时推送
- [✅ ] 是（需新增 WebSocket 端点）
- [ ] 否（使用轮询即可）

---

## 🟡 问题 4：Log 小窗数据来源（P1 - 重要）

### 4.1 日志来源
- [ ] Supabase `audit_logs` 表
- [✅ ] 后端 Python logger 输出（需新增日志收集 API）
- [ ] Prometheus 日志
- [ ] 混合来源（需聚合多个数据源）

### 4.2 日志级别过滤
- 默认显示：[ ✅] ERROR + WARNING [ ] ERROR only [ ] 可配置

### 4.3 日志格式（需要显示哪些字段？）
- [✅ ] 时间戳
- [✅ ] 日志级别（ERROR/WARNING/INFO）
- [✅] 用户 ID
- [ ] 操作类型（JWT 接入/消息发送/API 调用）
- [ ] 详细信息
- [ ] Trace ID
- [ ] 其他：___________

---

## 🟢 问题 5：JWT 测试失效原因（P2 - 次要）

### 5.1 失效表现
- [✅ ] 无法发起测试请求
- [✅ ] 测试结果不显示
- [ ✅] 测试结果不保存
- [ ] 其他：___________

### 5.2 是否需要先修复再重构
- [ ✅] 是（先修复，再整合到新 Dashboard）
- [ ] 否（直接在重构中修复）

---

## 🟢 问题 6：Prompt 版本控制实现（P2 - 次要）

### 6.1 版本控制方式
- [ ] 方案 A：SQLite 新增表 `ai_prompt_versions`
- [ ] 方案 B：在 `ai_prompts` 表新增字段 `version_history` (JSON)
- [ ✅] 方案 C：Git 风格版本控制（每次修改生成新记录）
- [ ] 其他：___________

### 6.2 版本回滚
- [✅ ] 是（需要一键回滚功能）
- [ ] 否

---

## 📐 技术实施建议确认

### 新增后端 API 端点
- [ ✅] 同意以上 API 设计
- [ ] 不同意，修改意见：___________

### SQLite 数据库扩展
- [ ✅] 同意以上表结构
- [ ] 不同意，修改意见：___________

---

## 📝 其他补充说明

（如有其他需求或疑问，请在此处补充）

```




```

---

**请填写完成后，将此文件内容回复给我，我将立即开始架构设计阶段。**


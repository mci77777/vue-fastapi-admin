# 开发者指南

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [run.py](file://run.py)
- [pyproject.toml](file://pyproject.toml)
- [requirements.txt](file://requirements.txt)
- [web/package.json](file://web/package.json)
</cite>

## 目录

1. [环境准备](#环境准备)
2. [本地开发环境搭建](#本地开发环境搭建)
3. [启动应用](#启动应用)
4. [代码规范](#代码规范)
5. [贡献流程](#贡献流程)
6. [调试技巧](#调试技巧)

## 环境准备

在开始开发之前，请确保您的系统已安装以下软件：

- **Python 3.8+**（推荐 Python 3.11，项目依赖中明确指定）
- **Node.js v18.8.0+**
- **pnpm**（建议全局安装，用于前端依赖管理）
- **Docker（可选）**：用于容器化部署和快速启动服务

**说明**：  
- 后端基于 FastAPI 框架，使用 Python 3.11 构建，需确保 Python 版本满足要求。  
- 前端使用 Vue3 + Vite 技术栈，Node.js 版本建议不低于 v18.8.0。  
- pnpm 是推荐的包管理工具，可通过 `npm install -g pnpm` 安装。

**Section sources**  
- [README.md](file://README.md#L1-L245)

## 本地开发环境搭建

按照以下步骤配置本地开发环境：

### 克隆仓库
```bash
git clone https://github.com/mizhexiaoxiao/vue-fastapi-admin.git
cd vue-fastapi-admin
```

### 安装后端依赖

项目支持两种依赖安装方式：

#### 方法一（推荐）：使用 `uv`（现代 Python 包管理工具）
```bash
# 安装 uv
pip install uv

# 创建并激活虚拟环境
uv venv
source .venv/bin/activate  # Linux/Mac
# 或
.\.venv\Scripts\activate  # Windows

# 安装依赖
uv add pyproject.toml
```

#### 方法二：使用 `pip` 安装
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate  # Linux/Mac
# 或
.\venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 安装前端依赖
```bash
cd web
pnpm install  # 或 npm install
```

**说明**：  
- `pyproject.toml` 文件中定义了所有 Python 依赖项，包括 FastAPI、Tortoise ORM、Pydantic 等。  
- `requirements.txt` 提供了兼容的依赖列表，适用于传统 pip 安装方式。  
- 前端依赖通过 `web/package.json` 管理，使用 pnpm 可提升安装速度和磁盘利用率。

**Section sources**  
- [README.md](file://README.md#L1-L245)
- [pyproject.toml](file://pyproject.toml#L1-L90)
- [requirements.txt](file://requirements.txt#L1-L61)

## 启动应用

### 启动后端服务
```bash
python run.py
```

服务将启动在 `http://0.0.0.0:9999`，默认开放端口为 **9999**。  
API 文档可通过 `http://localhost:9999/docs` 访问（Swagger UI）。

### 启动前端服务
```bash
cd web
pnpm dev
```

前端开发服务器将启动在 `http://localhost:5173`（Vite 默认端口）。

### 默认访问信息
- **前端地址**：[http://localhost:5173](http://localhost:5173)
- **后端 API**：[http://localhost:9999](http://localhost:9999)
- **API 文档**：[http://localhost:9999/docs](http://localhost:9999/docs)
- **演示账号**：
  - 用户名：`admin`
  - 密码：`123456`

**Section sources**  
- [run.py](file://run.py#L1-L14)
- [README.md](file://README.md#L1-L245)

## 代码规范

项目采用严格的代码规范以确保代码质量和团队协作效率。

### 后端规范
- 使用 **Black** 进行代码格式化（配置在 `pyproject.toml`）
- 使用 **Ruff** 进行代码 linting
- 使用 **isort** 管理导入顺序
- 所有 Python 代码应遵循 PEP8 规范

### 前端规范
- 使用 **ESLint** 进行代码检查（配置在 `web/package.json` 和 `.eslintConfig`）
- 使用 **Prettier** 进行代码格式化
- 支持自动修复：`pnpm run lint:fix`
- 提交前自动检查：通过 `lint-staged` 配置 Git 钩子

### IDE 建议配置
- **VS Code 推荐插件**：
  - Python（Microsoft）
  - Volar（Vue 3 支持）
  - ESLint
  - Prettier
  - GitLens
- 启用保存时自动格式化功能，确保代码风格统一。

**Section sources**  
- [pyproject.toml](file://pyproject.toml#L1-L90)
- [web/package.json](file://web/package.json#L1-L61)
- [README.md](file://README.md#L1-L245)

## 贡献流程

欢迎贡献代码！请遵循以下流程：

1. **提交 Issue**：
   - 在 GitHub 仓库中创建 Issue，描述问题或功能需求。
   - 标记适当的标签（如 bug、feature、enhancement）。

2. **开发流程**：
   - Fork 仓库并创建本地分支。
   - 实现功能或修复问题。
   - 确保代码通过 ESLint 和 Prettier 检查。
   - 提交符合规范的 commit 信息。

3. **提交 Pull Request (PR)**：
   - 推送分支至您的 Fork。
   - 在 GitHub 上创建 Pull Request。
   - 描述变更内容、解决的 Issue 编号（如 `Fixes #123`）。
   - 等待代码审查和合并。

**注意**：项目维护者鼓励 Star 以支持持续开发。

**Section sources**  
- [README.md](file://README.md#L1-L245)

## 调试技巧

### 查看日志
后端日志格式已在 `run.py` 中自定义，包含时间、日志级别、客户端地址和请求信息：
```python
LOGGING_CONFIG["formatters"]["default"]["fmt"] = "%(asctime)s - %(levelname)s - %(message)s"
LOGGING_CONFIG["formatters"]["access"]["fmt"] = '%(asctime)s - %(levelname)s - %(client_addr)s - "%(request_line)s" %(status_code)s'
```

启动服务后，控制台将输出详细访问日志，便于排查问题。

### 使用 Swagger UI 测试 API
访问 `http://localhost:9999/docs` 可打开交互式 API 文档界面，支持：
- 查看所有 API 端点
- 测试请求（GET、POST 等）
- 查看请求参数、响应结构和状态码
- 自动验证 JWT 鉴权（通过 Authorize 按钮）

### 使用浏览器开发者工具
- **Network 面板**：监控前端与后端的 API 请求，检查请求头、参数、响应数据。
- **Console 面板**：查看 JavaScript 错误和调试信息。
- **Application 面板**：查看本地存储（localStorage）中的 token 信息。
- **Vue DevTools**：调试 Vue 组件状态、props、events。

### 其他建议
- 使用 `print()` 或 `loguru` 在 Python 中添加临时日志。
- 利用 Vite 的热重载功能快速预览前端变更。
- 使用 `pnpm run lint` 检查前端代码规范。

**Section sources**  
- [run.py](file://run.py#L1-L14)
- [README.md](file://README.md#L1-L245)
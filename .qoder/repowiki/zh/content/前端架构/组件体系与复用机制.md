# 组件体系与复用机制

<cite>
**本文档引用文件**  
- [AppFooter.vue](file://web/src/components/common/AppFooter.vue)
- [AppProvider.vue](file://web/src/components/common/AppProvider.vue)
- [LoadingEmptyWrapper.vue](file://web/src/components/common/LoadingEmptyWrapper.vue)
- [QueryBar.vue](file://web/src/components/query-bar/QueryBar.vue)
- [CrudTable.vue](file://web/src/components/table/CrudTable.vue)
- [SvgIcon.vue](file://web/src/components/icon/SvgIcon.vue)
- [IconPicker.vue](file://web/src/components/icon/IconPicker.vue)
- [index.vue](file://web/src/layout/components/header/index.vue)
- [index.vue](file://web/src/layout/components/sidebar/index.vue)
- [index.vue](file://web/src/layout/components/tags/index.vue)
- [index.vue](file://web/src/views/system/user/index.vue)
</cite>

## 目录
1. [通用组件设计与复用](#通用组件设计与复用)
2. [查询与表格组件封装机制](#查询与表格组件封装机制)
3. [图标组件集成方案](#图标组件集成方案)
4. [布局组件结构设计](#布局组件结构设计)
5. [组件组合使用示例](#组件组合使用示例)

## 通用组件设计与复用

本系统通过抽象通用功能组件，实现跨页面复用，提升开发效率与一致性。

### AppFooter 组件
`AppFooter` 是一个极简的页脚组件，仅提供基础样式容器，用于统一页面底部布局风格。其设计强调轻量化与可扩展性，便于在不同页面中继承并填充实际内容。

### AppProvider 组件
`AppProvider` 作为全局配置提供者，封装了 Naive UI 的 `n-config-provider`，集中管理以下核心功能：
- 多语言支持（中文 `zhCN`）
- 深色主题切换（基于 `appStore.isDark` 状态）
- 主题样式覆盖（`naiveThemeOverrides`）
- 全局工具挂载（如 `$message`、`$dialog` 等）

该组件通过 `setupCssVar` 将主题变量注入 CSS 自定义属性，实现动态主题切换，并通过 `setupNaiveTools` 将常用方法暴露至 `window` 对象，便于在非组件上下文中调用。

### LoadingEmptyWrapper 组件
`LoadingEmptyWrapper` 统一处理加载、空数据与网络异常三种状态，具备以下特性：
- 支持 `loading`、`empty`、`network` 状态判断
- 内置 `Spin` 加载动画、自定义无数据图标（`icon-custom-no-data`）与网络错误提示
- 提供点击重试功能（`showNetworkReload`）
- 使用 `watch` 监听加载状态以更新网络状态

该组件通过 `v-show` 控制不同状态的显示，结合绝对定位实现层叠展示，确保用户体验一致。

**组件来源**  
- [AppFooter.vue](file://web/src/components/common/AppFooter.vue#L1-L3)
- [AppProvider.vue](file://web/src/components/common/AppProvider.vue#L1-L67)
- [LoadingEmptyWrapper.vue](file://web/src/components/common/LoadingEmptyWrapper.vue#L1-L82)

## 查询与表格组件封装机制

系统通过 `QueryBar` 与 `CrudTable` 实现高度可复用的查询与表格操作封装。

### QueryBar 组件
`QueryBar` 是一个灵活的查询条件容器，具备以下特点：
- 使用 `n-space` 布局自动换行，适应响应式设计
- 内置“重置”与“搜索”按钮，通过 `emit` 触发父组件事件
- 支持任意插槽内容，可自由组合输入框、下拉框等查询项
- 样式适配深色模式（`dark:bg-black`）

该组件作为查询区域的视觉容器，不包含具体业务逻辑，仅负责事件触发与布局。

### CrudTable 组件
`CrudTable` 是系统核心表格组件，封装了分页、搜索、批量操作等通用功能，支持前后端分页模式。

#### 核心参数
- `remote`: 是否后端分页
- `isPagination`: 是否启用分页
- `columns`: 表格列配置（支持 `selection` 类型实现批量操作）
- `getData`: 数据获取函数（约定分页参数 `page` 与 `page_size`）
- `queryItems`: 查询条件对象
- `extraParams`: 额外参数

#### 功能实现
- **分页管理**：使用 `pagination` 响应式对象管理当前页、页大小及总数
- **数据加载**：`handleQuery` 方法整合查询参数并调用 `getData` 获取数据
- **搜索与重置**：`handleSearch` 触发查询，`handleReset` 清空查询条件并重置分页
- **批量选择**：监听 `update:checked-row-keys` 事件，仅在列包含 `selection` 类型时触发 `onChecked` 事件

该组件通过 `defineExpose` 暴露关键方法，便于父组件手动调用刷新或重置操作。

**组件来源**  
- [QueryBar.vue](file://web/src/components/query-bar/QueryBar.vue#L1-L26)
- [CrudTable.vue](file://web/src/components/table/CrudTable.vue#L1-L151)

## 图标组件集成方案

系统基于 Iconify 实现动态图标渲染，提供 `SvgIcon` 与 `IconPicker` 两个核心组件。

### SvgIcon 组件
`SvgIcon` 用于渲染预注册的 SVG 图标，其工作原理如下：
- 接收 `icon` 名称与 `prefix` 前缀（默认 `icon-custom`）
- 构造 `symbolId`（如 `#icon-custom-home`）用于 `<use>` 引用
- 使用 `<svg><use xlink:href="..."/>` 渲染图标，支持颜色自定义

该组件依赖于构建时生成的 SVG 雪碧图（icons.js），确保图标按需加载且体积小。

### IconPicker 组件
`IconPicker` 提供图标选择器功能，支持：
- 输入关键词实时搜索图标（`watchDebounced` 防抖）
- 展示图标列表并支持点击选择
- 实时预览所选图标（`TheIcon` 组件）
- 链接至 Icones 官网查看更多图标

该组件结合 `NPopover` 实现下拉选择，`NInput` 提供搜索输入，`icons.js` 提供图标数据源。

**组件来源**  
- [SvgIcon.vue](file://web/src/components/icon/SvgIcon.vue#L1-L24)
- [IconPicker.vue](file://web/src/components/icon/IconPicker.vue#L1-L70)

## 布局组件结构设计

系统布局由 `header`、`sidebar`、`tags-view` 三部分构成，提供完整的导航与交互功能。

### Header 组件
`header` 包含以下子组件：
- `MenuCollapse`：菜单折叠/展开控制
- `BreadCrumb`：面包屑导航，显示当前路由层级
- `Languages`：语言切换
- `ThemeMode`：主题模式切换（亮/暗）
- `FullScreen`：全屏切换
- `UserAvatar`：用户头像与下拉菜单

布局采用 Flex 布局，左右分区，右侧为操作区。

### Sidebar 组件
`sidebar` 由 `SideLogo` 与 `SideMenu` 构成：
- `SideLogo`：展示系统 Logo
- `SideMenu`：基于 `n-menu` 实现的侧边菜单，支持路由导航

### TagsView 组件
`tags-view` 实现多标签页管理，功能包括：
- 显示当前打开的页面标签（`tagsStore.tags`）
- 支持点击切换、关闭标签
- 右键弹出上下文菜单（关闭其他、关闭全部等）
- 自动滚动至当前激活标签（`scrollXRef`）

使用 `ScrollX` 组件实现横向滚动，确保标签过多时仍可访问。

**组件来源**  
- [index.vue](file://web/src/layout/components/header/index.vue#L1-L23)
- [index.vue](file://web/src/layout/components/sidebar/index.vue#L1-L9)
- [index.vue](file://web/src/layout/components/tags/index.vue#L1-L101)

## 组件组合使用示例

以“用户管理”页面为例，展示 `CrudTable` 与 `QueryBar` 的典型集成方式。

### 使用场景
在 `system/user/index.vue` 中，通过以下方式组合组件：
1. 使用 `CommonPage` 作为页面容器
2. 在 `CrudTable` 中通过 `#queryBar` 插槽注入查询项
3. 使用 `QueryBarItem` 包裹每个查询字段（如用户名、邮箱）
4. 将查询条件绑定至 `v-model:query-items`
5. 传入 `columns` 与 `getData` 实现表格渲染与数据获取

### 响应式与可访问性
- 使用 `n-input` 的 `@keypress.enter` 实现回车搜索
- 表格操作按钮通过 `v-permission` 指令控制权限可见性
- 使用 `n-popconfirm` 防止误操作
- 表格内容通过 `ellipsis` 与 `tooltip` 处理长文本溢出

该模式可复用于角色、部门等系统管理模块，确保交互一致性。

**组件来源**  
- [index.vue](file://web/src/views/system/user/index.vue#L1-L495)